"use strict";angular.module("tojoApp",["ngRoute","ngSanitize"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("tojoApp").controller("MainCtrl",["$scope","todos",function(a,b){a.todos=b,b.onInitialized=function(){a.$apply()},a.update=function(b,c){13!==b.keyCode||b.shiftKey?8!==b.keyCode||c.content?c.set("content",c.content):(b.preventDefault(),c.deleteRecord(),a.todos.syncDown()):b.preventDefault()},a.complete=function(b){b.set("completed",!0),b.set("completedAt",(new Date).getTime()),console.log(b,"completed"),a.todos.syncDown()},a.snooze=function(b){b.set("snoozed",!0),b.set("unsnoozeAt",(new Date).getTime()+15e3),b.set("score",b.get("score")-1),console.log(b,"snoozed"),a.todos.syncDown()},a.newTodo={content:"",timeAdded:(new Date).getTime(),score:0,completed:!1,snoozed:!1,unsnoozeAt:(new Date).getTime()},a.addNewTodo=function(c){13!==c.keyCode||c.shiftKey||(c.preventDefault(),b.insert(a.newTodo),a.newTodo={content:"",timeAdded:(new Date).getTime(),score:0,completed:!1,snoozed:!1,unsnoozeAt:(new Date).getTime()})},a.output=function(){b.snapshot().forEach(function(a){console.log(a.get("content"))})}}]),angular.module("tojoApp").controller("AboutCtrl",["$scope",function(a){a.todos=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("tojoApp").directive("contenteditable",["$sce",function(a){return{restrict:"A",require:"?ngModel",scope:{model:"=ngModel"},link:function(b,c,d,e){e&&(b.$watch("model",function(){b.$eval(d.ngModel+" = model")}),b.$watch(d.ngModel,function(a){b.model=a}),c.bind("blur keyup change",function(){b.$apply(function(){var a=c.html();d.stripBr&&"<br>"===a&&(a=""),e.$setViewValue(a)})}),e.$render=function(){c.html(a.getTrustedHtml(e.$viewValue||""))})}}}]),angular.module("tojoApp").service("todos",function(){if(this.connected=!1,this.onInitialized=null,this._snapshot=[{content:"Wait a sec for it to connect to the cloud"}],this.snapshot=function(){return this.connected?this._snapshot.filter(function(a){return a.get("completed")?!1:a.get("snoozed")?!1:!0}).sort(function(a,b){var c=b.get("score")-a.get("score");return 0===c?b.get("timeAdded")-a.get("timeAdded"):c}):this._snapshot},this.data=null,this.backlog=[],this.insert=function(a){this.data?(this.data.insert(a),this.syncDown()):this.backlog.push(a)},this.syncDown=function(){if(this.data){var a=(new Date).getTime();this._snapshot=this.data.query().map(function(b){return b.get("snoozed")&&b.get("unsnoozeAt")<a&&b.set("snoozed",!1),$.extend(b,{raw:b._rawFieldValues(),content:b._rawFieldValues().content})})}},this.syncUp=function(){if(this.data){for(var a=0;a<this.backlog.length;++a)this.data.insert(this.backlog[a]);this.backlog=[]}},this.dropbox=new Dropbox.Client({key:"dg7kh1gl7wv9gj2",secret:"hp1rh6n8ia9fabr",token:"05PF-9qnGb8AAAAAAAAABEI3DKas5jHeRJcOMxH_U-I4a-JLcDkTS-ww3tTiEkWu"}),this.dropbox.isAuthenticated()){var a=this.dropbox.getDatastoreManager();a.openDefaultDatastore(angular.bind(this,function(a,b){a&&console.log("Error opening the datastore: "+a),this.data=b.getTable("todos"),this.connected=!0,console.log("connected"),this.syncUp(),this.syncDown(),this.onInitialized&&this.onInitialized()}))}});